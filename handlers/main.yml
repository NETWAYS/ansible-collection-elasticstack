---
# handlers file for logstash
- name: Restart Logstash
  service:
    name: logstash
    state: restarted
  when: logstash_enable | bool

- name: Restart Logstash noauto
  service:
    name: logstash
    state: restarted
  when: not logstash_config_autoreload and logstash_enable | bool

- name: Reconvert keystore
  shell: >
    openssl pkcs12
    -in "{{ logstash_certs_dir }}/{{ inventory_hostname }}.p12"
    -password pass:"{{ logstash_tls_key_passphrase }}"
    -nodes |
    openssl pkcs12
    -export
    -password pass:"{{ logstash_tls_key_passphrase }}"
    -out "{{ logstash_certs_dir }}/keystore.pfx"

- name: Reset permissions on keystore
  file:
    path: "{{ logstash_certs_dir }}/keystore.pfx"
    owner: root
    group: logstash
    mode: 0660
