---
# handlers file for logstash
- name: Restart Logstash
  service:
    name: logstash
    state: restarted
  when: logstash_enable | bool

- name: Restart Logstash noauto
  service:
    name: logstash
    state: restarted
  when: not logstash_config_autoreload and logstash_enable | bool

- name: Reconvert keystore
  shell: >
    openssl pkcs12
    -in "/etc/logstash/certs/cert.p12"
    -password pass:""
    -nodes |
    openssl pkcs12
    -export
    -password pass:""
    -out "/etc/logstash/certs/keystore.pfx"

- name: Reset permissions on keystore
  file:
    path: /etc/logstash/certs/keystore.pfx
    owner: root
    group: logstash
    mode: 0660
