---
# The workaround for arbitrarily named role directory is important because the git repo has one name and the role within it another
# Found at: https://github.com/ansible-community/molecule/issues/1567#issuecomment-436876722
- name: Converge
  collections:
    - netways.elasticstack
  hosts: localhost
  vars:
    es_to_date_1: null
  tasks:
    #
    # Test modules
    #
    - name: Test
      cert_info:
        ca_dir: es-ca/
        password: PleaseChangeMe
      register: test
    - name: Debug
      debug:
        msg: "{{ test }}"
    - name: Test path without / at end
      cert_info:
        ca_dir: es-ca
        password: PleaseChangeMe
    - name: Test required parameters (missing ca_dir)
      cert_info:
        password: PleaseChangeMe
      ignore_errors: true
    - name: Test required together parameters (only language code set)
      cert_info:
        ca_dir: es-ca
        password: PleaseChangeMe
      ignore_errors: true
    - name: Test wrong path
      cert_info:
        ca_dir: es-ca-wrong
        password: PleaseChangeMe
      ignore_errors: true
    - name: Debug with to_datetime() - (( test.not_valid_after | to_datetime()) - (ansible_date_time.date | to_datetime('%Y-%m-%d'))).days
      debug:
        msg: >-
          "{{ (( test.not_valid_after | to_datetime()) - (ansible_date_time.date | to_datetime('%Y-%m-%d'))).days }}"
    - name: Test wrong password
      cert_info:
        ca_dir: es-ca
        password: PleaseChangeMe-wrong
      ignore_errors: true
    - name: Test no password
      cert_info:
        ca_dir: es-ca
      ignore_errors: true
    - name: Test no parameters
      cert_info:
      ignore_errors: true
